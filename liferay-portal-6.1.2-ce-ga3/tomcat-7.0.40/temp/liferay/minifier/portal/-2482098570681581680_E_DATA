AUI.add("liferay-portlet-dynamic-data-mapping",function(k){var p=k.Array;var d=k.Lang;var n=k.FormBuilderField;var o=k.instanceOf;var h=d.isObject;var m=AUI.defaults.FormValidator;var r=["label","predefinedValue","tip"];var i={checkbox:["readOnly","required"],"ddm-fileupload":["predefinedValue"],DEFAULT:["readOnly"]};var j="";var q={attributeList:j,nodeName:j};var e="]]>";var a="<![CDATA[";var b=" ";var f="<{nodeName}{attributeList}></{nodeName}>";var g={dataType:1,name:1,options:1,type:1};m.STRINGS.structureFieldName=Liferay.Language.get("please-enter-only-alphanumeric-characters");m.RULES.structureFieldName=function(s){return(/^[\w\-]+$/).test(s)};var c=k.Component.create({ATTRS:{localizationMap:{validator:h,value:{}}},NAME:"availableField",EXTENDS:k.FormBuilderAvailableField});k.LiferayAvailableField=c;var l=k.Component.create({ATTRS:{availableFields:{validator:h,valueFn:function(){return l.AVAILABLE_FIELDS.DEFAULT}},portletNamespace:{value:j},portletResourceNamespace:{value:j},translationManager:{validator:h,value:{}},validator:{setter:function(u){var s=this;var t=k.merge({rules:{name:{required:true,structureFieldName:true}},fieldStrings:{name:{required:Liferay.Language.get("this-field-is-required")}}},u);return t},value:{}},strings:{value:{addNode:Liferay.Language.get("add-field"),button:Liferay.Language.get("button"),buttonType:Liferay.Language.get("button-type"),cancel:Liferay.Language.get("cancel"),deleteFieldsMessage:Liferay.Language.get("are-you-sure-you-want-to-delete-the-selected-entries"),duplicateMessage:Liferay.Language.get("duplicate"),editMessage:Liferay.Language.get("edit"),label:Liferay.Language.get("field-label"),large:Liferay.Language.get("large"),medium:Liferay.Language.get("medium"),multiple:Liferay.Language.get("multiple"),name:Liferay.Language.get("name"),no:Liferay.Language.get("no"),options:Liferay.Language.get("options"),predefinedValue:Liferay.Language.get("predefined-value"),propertyName:Liferay.Language.get("property-name"),required:Liferay.Language.get("required"),reset:Liferay.Language.get("reset"),save:Liferay.Language.get("save"),settings:Liferay.Language.get("settings"),showLabel:Liferay.Language.get("show-label"),small:Liferay.Language.get("small"),submit:Liferay.Language.get("submit"),tip:Liferay.Language.get("tip"),type:Liferay.Language.get("type"),value:Liferay.Language.get("value"),width:Liferay.Language.get("width"),yes:Liferay.Language.get("yes")}}},EXTENDS:k.FormBuilder,NAME:"liferayformbuilder",prototype:{initializer:function(){var s=this;s.LOCALIZABLE_FIELD_ATTRS=k.Array(r);s.MAP_HIDDEN_FIELD_ATTRS=k.clone(i);var t=s.translationManager=new Liferay.TranslationManager(s.get("translationManager"));s.after("render",function(u){t.render()});s.addTarget(Liferay.Util.getOpener().Liferay)},bindUI:function(){var s=this;l.superclass.bindUI.apply(s,arguments);s.translationManager.after("editingLocaleChange",s._afterEditingLocaleChange,s)},createField:function(){var s=this;var t=l.superclass.createField.apply(s,arguments);t.set("strings",s.get("strings"));return t},getFieldLocalizedValue:function(x,u,t){var s=this;var w=x.get("localizationMap");var v=k.Object.getValue(w,[t,u])||x.get(u);return s.normalizeValue(v)},getXSD:function(){var s=this;var v=[];var u=s.translationManager;var w=u.get("editingLocale");s._updateFieldsLocalizationMap(w);var t=s._createDynamicNode("root",{"available-locales":u.get("availableLocales").join(),"default-locale":u.get("defaultLocale")});v.push(t.openTag);s.get("fields").each(function(y,x,z){s._appendStructureTypeElementAndMetaData(y,v)});v.push(t.closeTag);return v.join(j)},normalizeValue:function(t){var s=this;if(d.isUndefined(t)){t=j}return t},_afterEditingLocaleChange:function(u){var s=this;var t=u.newVal;var v=u.prevVal;s._updateFieldsLocalizationMap(v);s._syncFieldsLocaleUI(t)},_appendStructureChildren:function(u,t){var s=this;u.get("fields").each(function(w,v,x){s._appendStructureTypeElementAndMetaData(w,t)})},_appendStructureFieldOptionsBuffer:function(v,t){var s=this;var u=v.get("options");if(u){p.each(u,function(y,x,z){var w=y.name;if(!w){w=k.FormBuilderField.buildFieldName("option")}var A=s._createDynamicNode("dynamic-element",{name:w,type:"option",value:Liferay.Util.escapeHTML(y.value)});t.push(A.openTag);s._appendStructureOptionMetaData(y,t);t.push(A.closeTag)})}},_appendStructureOptionMetaData:function(u,t){var s=this;var v=u.localizationMap;var w=s._createDynamicNode("entry",{name:"label"});k.each(v,function(z,x,B){if(h(z)){var y=s._createDynamicNode("meta-data",{locale:x});var A=s.normalizeValue(z.label);t.push(y.openTag,w.openTag,a+A+e,w.closeTag,y.closeTag)}})},_appendStructureTypeElementAndMetaData:function(w,u){var t=this;var v=t._createDynamicNode("dynamic-element",{autoGeneratedName:w.get("autoGeneratedName"),dataType:w.get("dataType"),fieldNamespace:w.get("fieldNamespace"),name:encodeURI(w.get("name")),type:w.get("type")});u.push(v.openTag);t._appendStructureFieldOptionsBuffer(w,u);t._appendStructureChildren(w,u);var s=t.translationManager.get("availableLocales");p.each(s,function(x,D,B){var z=t._createDynamicNode("meta-data",{locale:x});u.push(z.openTag);p.each(w.getProperties(),function(E,J,I){var F=E.attributeName;if(!g[F]){var H=t._createDynamicNode("entry",{name:F});var G=t.getFieldLocalizedValue(w,F,x);if((F==="predefinedValue")&&o(w,k.FormBuilderMultipleChoiceField)){G=k.JSON.stringify(p(G))}u.push(H.openTag,a+G+e,H.closeTag)}});if(o(w,k.FormBuilderTextField)){var A=t._createDynamicNode("entry",{name:"fieldCssClass"});var y=w.get("width");var C=k.getClassName("w"+y);u.push(A.openTag,a+C+e,A.closeTag)}u.push(z.closeTag)});u.push(v.closeTag)},_createDynamicNode:function(w,t){var s=this;var u=[];var v=[];if(!w){w="dynamic-element"}q.attributeList=j;q.nodeName=w;if(t){k.each(t,function(y,x,z){if(y!==undefined){u.push([x,'="',y,'" '].join(j))}});q.attributeList=b+u.join(j)}v=d.sub(f,q);v=v.replace(/\s?(>)(<)/,"$1$1$2$2").split(/></);return{closeTag:v[1],openTag:v[0]}},_onPropertyModelChange:function(s){var A=this;var u=s.changed;var y=s.target.get("attributeName");var w=A.editingField;var x=w.get("readOnlyAttributes");if(u.hasOwnProperty("value")&&(k.Array.indexOf(x,"name")===-1)){if(y==="name"){w.set("autoGeneratedName",s.autoGeneratedName===true)}else{if((y==="label")&&w.get("autoGeneratedName")){var z=u.value.newVal;w.set("name",z);var t=A.propertyList.get("data");var v=t.filter(function(C,B,D){return(C.get("attributeName")==="name")});if(v.length){v[0].set("value",w.get("name"),{autoGeneratedName:true})}}}}},_renderSettings:function(){var s=this;l.superclass._renderSettings.apply(s,arguments);s.propertyList.on("model:change",s._onPropertyModelChange,s)},_setAvailableFields:function(u){var t=this;var s=[];p.each(u,function(w,v,x){s.push(k.instanceOf(w,k.AvailableField)?w:new k.LiferayAvailableField(w))});return s},_syncFieldOptionsLocaleUI:function(v,t){var s=this;var u=v.get("options");p.each(u,function(y,x,A){var z=y.localizationMap;if(h(z)){var w=z[t];if(h(w)){y.label=w.label}}});v.set("options",u)},_syncFieldsLocaleUI:function(u,t){var s=this;t=t||s.get("fields");t.each(function(z,x,w){if(o(z,k.FormBuilderMultipleChoiceField)){s._syncFieldOptionsLocaleUI(z,u)}var y=z.get("localizationMap");var v=y[u];if(h(y)&&h(v)){p.each(s.LOCALIZABLE_FIELD_ATTRS,function(B,A,C){z.set(B,v[B])});s._syncUniqueField(z)}if(s.editingField===z){s.propertyList.set("data",z.getProperties())}s._syncFieldsLocaleUI(u,z.get("fields"))})},_updateFieldOptionsLocalizationMap:function(v,t){var s=this;var u=v.get("options");p.each(u,function(x,w,z){var y=x.localizationMap;if(!h(y)){y={}}y[t]={label:x.label};x.localizationMap=y});v.set("options",u)},_updateFieldsLocalizationMap:function(u,t){var s=this;t=t||s.get("fields");t.each(function(w,v,y){var x={};x[u]=w.getAttrs(s.LOCALIZABLE_FIELD_ATTRS);w.set("localizationMap",k.mix(x,w.get("localizationMap")));if(o(w,k.FormBuilderMultipleChoiceField)){s._updateFieldOptionsLocalizationMap(w,u)}s._updateFieldsLocalizationMap(u,w.get("fields"))})}},normalizeKey:function(s){s=k.Text.AccentFold.fold(s);k.each(s,function(u,t,v){if(!k.Text.Unicode.test(u,"L")&&!k.Text.Unicode.test(u,"N")){s=s.replace(u,b)}});return s.replace(/\s/g,"_")}});l.DEFAULT_ICON_CLASS="aui-form-builder-field-icon aui-form-builder-field-icon-default";l.AVAILABLE_FIELDS={DEFAULT:[{fieldLabel:Liferay.Language.get("button"),iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-button",label:Liferay.Language.get("button"),type:"button"},{fieldLabel:Liferay.Language.get("checkbox"),iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-checkbox",label:Liferay.Language.get("checkbox"),type:"checkbox"},{fieldLabel:Liferay.Language.get("fieldset"),iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-fieldset",label:Liferay.Language.get("fieldset"),type:"fieldset"},{fieldLabel:Liferay.Language.get("file-upload"),iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-fileupload",label:Liferay.Language.get("file-upload"),type:"fileupload"},{fieldLabel:Liferay.Language.get("text-box"),iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-text",label:Liferay.Language.get("text-box"),type:"text"},{fieldLabel:Liferay.Language.get("text-area"),iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-textarea",label:Liferay.Language.get("text-area"),type:"textarea"},{fieldLabel:Liferay.Language.get("radio-buttons"),iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-radio",label:Liferay.Language.get("radio-buttons"),type:"radio"},{fieldLabel:Liferay.Language.get("select-option"),iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-select",label:Liferay.Language.get("select-option"),type:"select"}],DDM_STRUCTURE:[{hiddenAttributes:i.checkbox,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-checkbox",label:Liferay.Language.get("boolean"),type:"checkbox"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-date",label:Liferay.Language.get("date"),type:"ddm-date"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-decimal",label:Liferay.Language.get("decimal"),type:"ddm-decimal"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-document",label:Liferay.Language.get("documents-and-media"),type:"ddm-documentlibrary"},{hiddenAttributes:i["ddm-fileupload"],iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-fileupload",label:Liferay.Language.get("file-upload"),type:"ddm-fileupload"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-integer",label:Liferay.Language.get("integer"),type:"ddm-integer"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-number",label:Liferay.Language.get("number"),type:"ddm-number"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-radio",label:Liferay.Language.get("radio"),type:"radio"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-select",label:Liferay.Language.get("select"),type:"select"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-text",label:Liferay.Language.get("text"),type:"text"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-textarea",label:Liferay.Language.get("text-box"),type:"textarea"}],DDM_TEMPLATE:[{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-paragraph",label:Liferay.Language.get("paragraph"),type:"ddm-paragraph"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-separator",label:Liferay.Language.get("separator"),type:"ddm-separator"},{hiddenAttributes:i.DEFAULT,iconClass:"aui-form-builder-field-icon aui-form-builder-field-icon-fieldset",label:Liferay.Language.get("fieldset"),type:"fieldset"}]};Liferay.FormBuilder=l},"",{requires:["aui-form-builder","aui-form-validator","aui-text","json","liferay-translation-manager"]});