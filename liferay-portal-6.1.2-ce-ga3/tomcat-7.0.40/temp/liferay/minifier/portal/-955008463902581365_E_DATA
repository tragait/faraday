AUI.add("liferay-portlet-journal",function(m){var i=m.DataType;var d=m.JSON;var g=m.Lang;var h=function(){var v="";var u=Liferay.Portlet.Journal.PROXY.instanceIdKey;for(var t=0;t<8;t++){var w=Math.floor(Math.random()*u.length);v+=u.substring(w,w+1)}return v};var l=function(){return(++m.Env._uidx)};var j='<div id="{name}" name="{name}"></div>';var r='<div><li class="structure-field {cssClass}"><span class="journal-article-close"></span><span class="folder"><div class="field-container"><input class="journal-article-localized" type="hidden" value="false" /><div class="journal-article-move-handler"></div><label for="" class="journal-article-field-label"><span>{fieldLabel}</span></label><div class="journal-article-component-container"></div><span class="aui-field aui-field-choice journal-article-localized-checkbox"><span class="aui-field-content"><span class="aui-field-element aui-field-label-right"><input type="hidden" value="false" name="{portletNamespace}{instanceId}localized-checkbox"><input type="checkbox" onclick="Liferay.Util.updateCheckboxValue(this); " name="{portletNamespace}{instanceId}localized-checkboxCheckbox" id="{portletNamespace}{instanceId}localized-checkboxCheckbox" class="aui-field-input aui-field-input-choice"> </span><label for="{portletNamespace}{instanceId}localized-checkboxCheckbox" class="aui-field-label">{localizedLabelLanguage}</label></span></span><div class="journal-article-required-message portlet-msg-error">{requiredFieldLanguage}</div><div class="journal-article-buttons {articleButtonsRowCSSClass}"><span class="aui-field aui-field-inline aui-field-text journal-article-variable-name"><span class="aui-field-content"><label for="{portletNamespace}{instanceId}variableName" class="aui-field-label">{variableNameLanguage}</label><span class="aui-field-element "><input type="text" size="25" value="{variableName}" name="{portletNamespace}variableName" id="{portletNamespace}{instanceId}variableName" class="aui-field-input aui-field-input-text"></span></span></span>{editButtonTemplateHTML}{repeatableButtonTemplateHTML}</div></div><ul class="folder-droppable"></ul></span></li></div>';var o='<div id="{0}" class="journal-article-helper not-intersecting"><div class="journal-component"></div><div class="forbidden-action"></div></div>';var e='<div class="journal-article-instructions-container journal-article-instructions-message portlet-msg-info"></div>';var n="<option></option>";var s='<div class="aui-tree-placeholder aui-tree-sub-placeholder"></div>';var q='<input class="aui-field-input lfr-input-text" type="text" value="" size="40"/>';var b='<img align="top" class="journal-article-instructions-container" src="'+themeDisplay.getPathThemeImages()+'/portlet/help.png" />';var k=new m.DataSet();var a=function(w,v){var t=this;t.articleId=v;t.timers={};t.portletNamespace=w;t._helperId=t._getNamespacedId("journalArticleHelper",t.portletNamespace,"");var u=g.sub(o,[t._helperId]);t._helper=m.Node.create(u);t._helper.appendTo(document.body);t.acceptChildren=true;t._initializeTagsSuggestionContent();t._initializePageLoadFieldInstances();t._attachDelegatedEvents();t._attachEvents();t._updateOriginalStructureXSD()};a.prototype={addStructure:function(x,y,w,v,E,C,G){var F=this;var t="";var u=true;var A=true;var H=F.getDefaultLocale();var z=["long","java.lang.String","boolean","java.lang.String","java.util.Map<java.util.Locale, java.lang.String>","java.util.Map<java.util.Locale, java.lang.String>","java.lang.String","com.liferay.portal.service.ServiceContext"];var B={};B[H]=v;var D={};D[H]=(g.isString(E)&&E)?E:null;Liferay.Service.Journal.JournalStructure.addStructure({groupId:x,structureId:y,autoStructureId:w,parentStructureId:t,nameMap:d.stringify(B),descriptionMap:d.stringify(D),xsd:C,serviceContext:d.stringify({addGroupPermissions:u,addGuestPermissions:A,scopeGroupId:x}),serviceParameterTypes:d.stringify(z)},function(I){if(g.isFunction(G)){G(I)}})},buildHTMLEditor:function(u){var t=this;var w=u.get("instanceId");var v=t.portletNamespace+"structure_el_"+w+"_content";var x=g.sub(j,{id:v,name:v});u.set("innerHTML",x);t._loadEditor(u,v);return x},buildHTMLEditorURL:function(u){var t=this;var v=a.PROXY.editorURL;v=v.replace(/LIFERAY_NAME/,m.guid());var w=a.PROXY.editorImpl;v=v.replace(/LIFERAY_SKIP_EDITOR/,Liferay.Util.isEditorPresent(w));return v},canDrop:function(v){var t=this;var u=t.getComponentType(v);var w=true;if((u=="list")||(u=="multi-list")){w=false}else{if(v.hasClass("repeated-field")||v.hasClass("parent-structure-field")){w=false}}return w},clearMessage:function(u){var t=this;var v=m.one(u);var w=t.timers[u];if(w){w.cancel()}v.hide()},closeEditFieldOptions:function(){var t=this;if(t.editContainerContextPanel){t.editContainerContextPanel.set("visible",false)}t.unselectFields()},closeField:function(v){var t=this;if((t._hasParentField(v)||t._hasFirstLevelFields())&&confirm(Liferay.Language.get("are-you-sure-you-want-to-delete-this-field-and-all-its-children"))){var u=t.getFieldInstance(v);u.destroy();t.closeRepeatedSiblings(v);t.closeEditFieldOptions();if(v.inDoc()){v.remove()}}},closeRepeatedSiblings:function(w){var t=this;var u=t.getFieldInstance(w);if(!u.get("repeated")){var v=t.getRepeatedSiblings(u);if(v){v.remove()}}},createNestedList:function(v,w,x,y){var t=this;var u=function(A){m.each(x,function(C,B,D){if(B&&g.isFunction(C)){A.on(B,C)}})};var z={dropOn:".folder"};w=m.merge(z,w);if(!t._nestedList){t._nestedList=new m.NestedList(w);u(t._nestedList)}if(y&&!t._nestedListComponents){t._nestedListComponents=new m.NestedList(w);u(t._nestedListComponents)}if(m.instanceOf(v,m.Node)){v=m.all(v)}v.each(function(B,A,D){var C=t._nestedList;if(y){C=t._nestedListComponents}C.add(B)})},disableEditMode:function(){var t=this;m.getBody().removeClass("portlet-journal-edit-mode");var x=t.getById("editStructureButton");var y=t.getById("editStructureLink");var u=t.getById("journalComponentList");var w=t.getById("saveStructureButton");t.closeEditFieldOptions();w.ancestor(".aui-button").hide();u.hide();var v=Liferay.Language.get("edit");y.show();x.ancestor(".aui-button").hide();m.all("input.journal-list-label").attr("disabled","disabled");if(t.structureChange()){var z=t.getById("structureMessage");t.showMessage(z,"alert",null,30000)}},disableFields:function(){var t=this;var u=t.getById("journalArticleContainer");u.all("input:not(:button)").attr("disabled","disabled");u.all("textarea, select").attr("disabled","disabled")},downloadArticleContent:function(){var t=this;var w=themeDisplay.getPathMain()+"/journal/get_article_content";var v=t.getPrincipalForm("fm2");var u=t.getArticleContentXML();var x=t.getByName(v,"xml",true);if(t.structureChange()){if(confirm(Liferay.Language.get("you-should-save-the-structure-first"))){t.openSaveStructureDialog()}}else{v.attr("action",w);v.attr("target","_self");x.val(u);submitForm(v,null,false)}},editContainerNormalMode:function(){var t=this;var u=t.getById("journalArticleEditFieldWrapper");u.removeClass("save-mode");t.editContainerModified=false},editContainerSaveMode:function(){var t=this;var u=t.getById("journalArticleEditFieldWrapper");u.addClass("save-mode");t.editContainerModified=true},enableEditMode:function(){var t=this;m.getBody().addClass("portlet-journal-edit-mode");var y=t.getById("editStructureLink");var u=t.getById("journalComponentList");var z=t.getById("structureMessage");var w=t.getById("structureTree");t.editContainerNormalMode();y.hide();u.show();w.all(".journal-list-label").attr("disabled","");t.clearMessage(z);var x=t.getById("editStructureButton");var v=t.getById("saveStructureButton");if(x){x.ancestor(".aui-button").show()}if(v){v.ancestor(".aui-button").show()}t._attachEditStructureEvents()},enableFields:function(){var t=this;var u=t.getById("journalArticleContainer");u.all("input:not(:button)").attr("disabled","");u.all("textarea, select").attr("disabled","")},getArticleContentXML:function(){var B=this;var x=[];var u=B._getNamespacedId("#structureTree");var C=m.all(u+" > li");var v=B.hasStructure();var y;if(!v){var E=C.item(0);if(E){var F=B.getFieldInstance(E);y=F.getContent(E)}}else{var w=null;var A=[];var G=false;var t=m.all("[name="+B.portletNamespace+"available_locales]");var D=B.getDefaultLocale();B.getFields().each(function(K,I,L){var H=B.getFieldInstance(K);var J=H.get("localized");if(J){G=true}});if(G){t.each(function(J,I,K){var H=J.val();if(H){A.push(H)}});w={"available-locales":A.join(","),"default-locale":D}}else{w={"available-locales":D,"default-locale":D}}var z=B._createDynamicNode("root",w);x.push(z.openTag);C.each(function(I,H,J){B._appendStructureTypeElementAndMetaData(I,x,true)});x.push(z.closeTag);y=x.join("")}return y},getById:function(v,u){var t=this;return m.one(t._getNamespacedId(v,u))},getByName:function(x,v,w){var t=this;var u=w?v:t.portletNamespace+v;return m.one(x).one("[name="+u+"]")},getComponentType:function(t){return t.attr("dataType")},getDefaultLocale:function(){var t=this;var u=t.getById("defaultLocale");if(u){u=u.val()}return u},getEditButton:function(u){var t=this;return u.one(".edit-button .aui-button-input")},getFieldInstance:function(u){var t=this;var v=u.get("id");return k.item(v)},getFields:function(){var t=this;var u=t._getNamespacedId("#structureTree");return m.all(u+" li")},getGroupId:function(){var t=this;var u=themeDisplay.getScopeGroupId();if(t.articleId){var v=t.getPrincipalForm();var x=t.getByName(v,"groupId");var w=x.val();if(w){u=w}}return u},getParentStructureId:function(){var t=this;var v=t.getById("parentStructureId");var u;if(v){u=v.val()}return u},getRepeatedSiblings:function(v){var u=this;var w=u._getNamespacedId("#structureTree");var t=w+" li[dataName="+v.get("variableName")+"].repeated-field";return m.all(t)},getSaveDialog:function(H){var G=this;if(!G._saveDialog){var v=G.getById("saveStructureTemplateDialog");var C=v.html();var E=Liferay.Language.get("editing-structure-details");var u=G.getPrincipalForm();var z=G.getByName(u,"groupId");var F=G.getByName(u,"structureGroupId");var D=G.getByName(u,"structureId");var B=G.getByName(u,"structureName");var y=G.getByName(u,"structureDescription");var t=G.getByName(u,"structureXSD");var w=function(){var K=G._saveDialog.fields;G.showMessage(K.messageElement,"info",Liferay.Language.get("waiting-for-an-answer"));var M=G.getPrincipalForm();var J=G.getByName(M,"structureId");var L=J.val();if(!L){var I=K.saveStructureAutogenerateIdCheckbox.get("checked");G.addStructure(z.val(),K.dialogStructureId.val(),I,K.dialogStructureName.val(),K.dialogDescription.val(),K.contentXSD,A)}else{G.updateStructure(K.dialogStructureGroupId.val(),K.dialogStructureId.val(),G.getParentStructureId(),K.dialogStructureName.val(),K.dialogDescription.val(),K.contentXSD,A)}};G._saveDialog=new m.Dialog({align:Liferay.Util.Window.ALIGN_CENTER,bodyContent:C,buttons:[{handler:w,label:Liferay.Language.get("save")},{handler:function(){this.close()},label:Liferay.Language.get("cancel")}],modal:true,title:E,width:550}).render();G._saveDialog.fields={autoGenerateIdMessage:Liferay.Language.get("autogenerate-id"),contentXSD:"",dialogDescription:G.getById("saveStructureStructureDescription"),dialogStructureGroupId:G.getById("saveStructureStructureGroupId"),dialogStructureId:G.getById("saveStructureStructureId"),dialogStructureName:G.getById("saveStructureStructureName"),idInput:G.getById("saveStructureStructureId"),loadDefaultStructure:G.getById("loadDefaultStructure"),messageElement:G.getById("saveStructureMessage"),saveStructureAutogenerateId:G.getById("saveStructureAutogenerateId"),saveStructureAutogenerateIdCheckbox:G.getById("saveStructureAutogenerateIdCheckbox"),showStructureIdContainer:G.getById("showStructureIdContainer"),structureIdContainer:G.getById("structureIdContainer"),structureNameLabel:G.getById("structureNameLabel")};var x=G._saveDialog.fields;var A=function(K){var J=K.exception;if(!J){y.val(x.dialogDescription.val());D.val(K.structureId);B.val(x.dialogStructureName.val());t.val(encodeURIComponent(x.contentXSD));x.dialogStructureGroupId.val(K.structureGroupId);x.dialogStructureId.val(K.structureId);x.structureNameLabel.html(x.dialogStructureName.val());x.saveStructureAutogenerateIdCheckbox.hide();if(x.loadDefaultStructure){x.loadDefaultStructure.show()}x.dialogStructureId.attr("disabled","disabled");G.showMessage(x.messageElement,"success",Liferay.Language.get("your-request-processed-successfully"));var L=G.getById("structureMessage");L.hide()}else{var I=G._translateErrorMessage(J);G.showMessage(x.messageElement,"error",I)}};x.saveStructureAutogenerateIdCheckbox.on("click",function(I){var K=I.target;var J=K.get("checked");x.saveStructureAutogenerateId.val(J);if(J){x.dialogStructureId.attr("disabled","disabled").val(x.autoGenerateIdMessage)}else{x.dialogStructureId.attr("disabled","").val("")}});x.showStructureIdContainer.on("click",function(I){x.structureIdContainer.toggle();I.halt()});x.dialogStructureName.focus()}else{G._saveDialog.show()}if(H){H.apply(G,[G._saveDialog])}},getSelectedField:function(){var u=this;var v=null;var t=u.getFields();if(t){v=t.filter(".selected")}return v?v.item(0):null},getSourceByNode:function(u){var t=this;return u.ancestor("li",true)},getStructureXSD:function(){var t=this;var v=[];var x=t._getNamespacedId("#structureTree");var w=m.all(x+" > li.structure-field:not(.repeated-field)").filter(":not(.parent-structure-field)");var u=t._createDynamicNode("root");v.push(u.openTag);m.each(w,function(z,y,A){t._appendStructureTypeElementAndMetaData(z,v)});v.push(u.closeTag);return v.join("")},getTextAreaFields:function(){var u=this;var v=u._getNamespacedId("#structureTree");var t=m.all(v+" li[dataType=text_area] div.journal-article-component-container");return t.filter(function(x,w,y){if(x.ancestor("li").attr("datatype")=="text_area"){return x}})},getPrincipalFieldElement:function(v){var t=this;var u=v.one("div.journal-article-component-container");return u.one(".aui-field-input")},getPrincipalForm:function(u){var t=this;return m.one("form[name="+t.portletNamespace+(u||"fm1")+"]")},getNodeTypeContent:function(){var t=this;return t.hasStructure()?"dynamic-content":"static-content"},hasStructure:function(){var t=this;var v=t.getPrincipalForm();var u=t.getByName(v,"structureId");return u&&u.val()},hasTemplate:function(){var t=this;var v=t.getPrincipalForm();var u=t.getByName(v,"templateId");return u&&u.val()},helperIntersecting:function(){var t=this;t._helper.removeClass("not-intersecting")},helperNotIntersecting:function(u){var t=this;t._helper.addClass("not-intersecting")},hideEditContainerMessage:function(){var u=this;var t=u.getById("journalMessage");t.hide()},loadDefaultStructure:function(){var t=this;var w=t.getPrincipalForm();var v=t.getByName(w,"structureId");var u=t.getByName(w,"templateId");var x=t.getByName(w,"content");v.val("");u.val("");x.val("");submitForm(w)},loadEditFieldOptions:function(u){var E=this;var G=E.getFieldInstance(u);var w=function(H,I){var L=H.get("id");var K=m.one("#"+L+"Checkbox");var J=m.DataType.Boolean.parse(I);H.val(J);if(K){K.set("checked",J)}};if(G){var D=E.getById("#journalArticleEditFieldWrapper");var C=E.getById("displayAsTooltip");var F=E.getById("repeatable");var z=E.getById("fieldType");var y=E.getById("indexType");var x=E.getById("instructions");var B=E.getById("predefinedValue");var A=E.getById("required");var v=E.getById("fieldLabel");z.val(G.get("fieldType"));y.val(G.get("indexType"));w(C,G.get("displayAsTooltip"));w(F,G.get("repeatable"));w(A,G.get("required"));v.val(G.get("fieldLabel"));x.val(G.get("instructions"));B.val(G.get("predefinedValue"));var t=D.all("input[type=text], select:not([name$=fieldType]), textarea, input[type=checkbox]");if(G.get("repeated")||G.get("parentStructureId")){t.attr("disabled","disabled")}else{t.attr("disabled","")}}},normalizeValue:function(u){var t=this;if(g.isUndefined(u)){u=""}return u},openPopupWindow:function(u,v,w){var t=this;Liferay.Util.openWindow({dialog:{align:Liferay.Util.Window.ALIGN_CENTER,width:680},id:t.portletNamespace+w,title:v,uri:u})},openSaveStructureDialog:function(){var t=this;var y=t.getPrincipalForm();var u=t.getByName(y,"structureId");var v=t.getByName(y,"structureName");var x=t.getByName(y,"structureDescription");var w=u.val();t.getSaveDialog(function(A){var z=A.fields;z.contentXSD=t.getStructureXSD();z.dialogStructureName.val(v.val());z.dialogDescription.val(x.val());z.dialogStructureId.attr("disabled","disabled").val(z.autoGenerateIdMessage);if(w){z.saveStructureAutogenerateId.hide();z.dialogStructureId.val(u.val())}A.show();A._setAlignCenter(true)})},previewArticle:function(){var F=this;var u=F.getPrincipalForm();var z=F.getPrincipalForm("fm2");var H=F.getArticleContentXML();if(F.structureChange()){if(confirm(Liferay.Language.get("you-should-save-the-structure-first"))){F.openSaveStructureDialog()}}else{if(F.hasStructure()&&!F.hasTemplate()&&!F.updateStructureDefaultValues()){var D=Liferay.Language.get("please-add-a-template-to-render-this-structure");alert(D);F.showMessage("#selectTemplateMessage","info",D,30000);var x=F.getById("selectTemplateButton");if(x){x.focus()}}else{var G=F.getDefaultLocale();var E=F.getByName(u,"type");var v=F.getByName(u,"version");var C=F.getByName(u,"structureId");var w=F.getByName(u,"templateId");var t=themeDisplay.getPathMain()+"/journal/view_article_content?cmd=preview&groupId="+F.getGroupId()+"&articleId="+F.articleId+"&version="+v.val()+"&languageId="+G+"&type="+E.val()+"&structureId="+C.val()+"&templateId="+w.val();z.attr("action",t);z.attr("target","_blank");var y=F.getByName(u,"title_"+G);var B=F.getByName(z,"title",true);var A=F.getByName(z,"xml",true);B.val(y.val());A.val(H);submitForm(z,null,false)}}},renderEditFieldOptions:function(w){var u=this;var v=u.getEditButton(w);var t=u.getFields();u.editContainerNormalMode();t.removeClass("selected");w.addClass("selected");u.hideEditContainerMessage();u.loadEditFieldOptions(w);if(u.editContainerContextPanel){u.editContainerContextPanel.refreshAlign()}},repeatField:function(v){var t=this;var x=function(F,z){var I=t.getFieldInstance(F).clone();var G=h();z.addClass("repeated-field");z.removeClass("yui-dd-drop yui-dd-draggable");var B=z.resetId().get("id");k.add(B,I);I.set("source",z);I.set("instanceId",G);var H=z.one(".journal-article-localized-checkbox");if(H){var J=H.one(".aui-field-input");var A=H.one(".aui-choice-label");var y=B+J.attr("id");J.attr("id",y);A.attr("for",y);J.attr("checked",false)}var E=I.get("fieldType");var C;if(E=="boolean"){C=z.one(".journal-article-component-container");C.one(".aui-field-input").attr("checked",false)}else{if(E=="document_library"||E=="text"){C=z.one(".journal-article-component-container");C.one(".aui-field-input").val("")}else{if(E=="image"){z.all(".journal-image-preview, .journal-image-show-hide").remove(true)}else{if(E=="text_area"){var D=t.buildHTMLEditor(I);C=z.one(".journal-article-component-container");C.html(D)}else{if(E=="text_box"){C=z.one(".journal-article-component-container");C.one(".aui-field-input").html("")}}}}}return I};var w=v.clone();v.placeAfter(w);x(v,w);var u=w.all(".structure-field");u.each(function(z){var y=x(z,z)})},repositionEditFieldOptions:function(){var u=this;var v=u.getById("journalArticleEditFieldWrapper");var t=!v.ancestor(".aui-overlaycontextpanel-hidden");if(t){setTimeout(function(){var w=u.getSelectedField();u.renderEditFieldOptions(w)},200)}},saveArticle:function(v){var G=this;var u=G.getPrincipalForm();if(G.structureChange()){if(confirm(Liferay.Language.get("you-should-save-the-structure-first"))){G.openSaveStructureDialog()}}else{if(G.hasStructure()&&!G.hasTemplate()&&!G.updateStructureDefaultValues()){var F=Liferay.Language.get("please-add-a-template-to-render-this-structure");alert(F);G.showMessage("#selectTemplateMessage","info",F,30000);var x=G.getById("selectTemplateButton");if(x){x.focus()}}else{if(!v){v=G.articleId?"update":"add"}var E=G.getByName(u,"articleId");var y=G.getByName(u,"classNameId");var B=G.getByName(u,"cmd");var D=G.getByName(u,"content");var w=G.getByName(u,"newArticleId");var A=G.getByName(u,"workflowAction");var z=Liferay.Util.toNumber(y.val());var t=z||G.validateRequiredFields();if(t){if(v=="publish"){A.val(Liferay.Workflow.ACTION_PUBLISH);v=G.articleId?"update":"add"}B.val(v);if(!G.articleId){E.val(w.val())}var C=G.getArticleContentXML();D.val(C);submitForm(u)}}}},saveEditFieldOptions:function(t){var H=this;var J=H.getFieldInstance(t);if(J){var G=H.getById("displayAsTooltip");var C=H.getById("displayAsTooltipCheckbox");var I=H.getById("repeatable");var u=H.getById("repeatableCheckbox");var B=H.getById("fieldType");var z=H.getById("indexType");var y=H.getById("instructions");var F=H.getById("predefinedValue");var E=H.getById("required");var x=H.getById("requiredCheckbox");var v=H.getById("fieldLabel");var A=t.one(".journal-article-localized");var w="";if(A){w=A.val()}var D=H.getById("journalMessage");m.each({displayAsTooltip:C.attr("checked"),fieldType:B.val(),indexType:z.val(),instructions:y.val(),localizedValue:w,predefinedValue:F.val(),repeatable:u.attr("checked"),required:x.attr("checked")},function(L,K,M){J.set(K,L)});H.updateFieldLabelName(J,v.val());H.showMessage(D,"success",Liferay.Language.get("your-request-processed-successfully"));H.editContainerNormalMode()}},showMessage:function(u,y,z,v){var t=this;var w=m.one(u);var x="save-structure-message portlet-msg-"+(y||"success");w.attr("className",x);w.show();if(t.editContainerContextPanel){t.editContainerContextPanel.refreshAlign()}if(z){w.html(z)}t.timers[u]=m.later(v||5000,t,function(){w.hide();if(t.editContainerContextPanel){t.editContainerContextPanel.refreshAlign()}})},structureChange:function(x){var t=this;var w=t.getPrincipalForm();var u=t.getByName(w,"structureXSD").val();var v=(u!=encodeURIComponent(t.getStructureXSD()));return v},translateArticle:function(){var t=this;var y=t.getPrincipalForm();var A=t.getByName(y,"classNameId");var w=t.getByName(y,"cmd");var z=t.getByName(y,"content");var u=Liferay.Util.toNumber(A.val());var v=u||t.validateRequiredFields();if(v){w.val("translate");var x=t.getArticleContentXML();z.val(x);submitForm(y)}},unselectFields:function(){var t=this;var u=t.getSelectedField();if(u){u.removeClass("selected")}},updateFieldLabelName:function(u,w){var t=this;var v=t.getRepeatedSiblings(u);v.each(function(y,x,A){var z=t.getFieldInstance(y);z.set("fieldLabel",w)});u.set("fieldLabel",w)},updateFieldVariableName:function(u,w){var t=this;var v=t.getRepeatedSiblings(u);v.each(function(y,x,A){var z=t.getFieldInstance(y);z.set("variableName",w)});u.set("variableName",w)},updateStructure:function(v,w,t,u,B,z,D){var C=this;var E=C.getDefaultLocale();var x=["long","java.lang.String","java.lang.String","java.util.Map<java.util.Locale, java.lang.String>","java.util.Map<java.util.Locale, java.lang.String>","java.lang.String","com.liferay.portal.service.ServiceContext"];var y={};y[E]=u;var A={};A[E]=(g.isString(B)&&B)?B:null;Liferay.Service.Journal.JournalStructure.updateStructure({groupId:v,structureId:w,parentStructureId:t||"",nameMap:d.stringify(y),descriptionMap:d.stringify(A),xsd:z,serviceContext:d.stringify({scopeGroupId:v}),serviceParameterTypes:d.stringify(x)},function(F){if(g.isFunction(D)){D(F)}})},updateStructureDefaultValues:function(){var t=this;var v=t.getPrincipalForm();var u=t.getByName(v,"classNameId");return(u&&u.val()>0)},updateTextAreaVisibility:function(u){var t=this;var v=t.getTextAreaFields();if(v){v.setStyle("visibility",u)}},validateRequiredFields:function(){var u=this;var x=true;var A=null;var z=u._getNamespacedId("#structureTree");var t=m.all(z+" li");var w=t.filter("[dataRequired=true]");var v=m.all(z+" li .field-container");v.removeClass("required-field");m.each(w,function(E,C,G){var B=u.getFieldInstance(E);var D=B.getContent(E);if(!D){var F=E.one(".field-container");F.addClass("required-field");if(x){A=u.getPrincipalFieldElement(E)}x=false}});if(A){var y=A.ancestors(".form-section");Liferay.fire("requiredFieldError",{sectionId:"#"+y.attr("id")});A.focus()}return x},_appendStructureChildren:function(y,w,v){var u=this;var t="> span.folder > ul > li";if(!v){t+=".structure-field:not(.repeated-field):not(.parent-structure-field)"}var x=y.all(t);m.each(x,function(A,z,B){u._appendStructureTypeElementAndMetaData(A,w,v)})},_appendStructureTypeElementAndMetaData:function(I,M,G){var R=this;var O=R.getFieldInstance(I);if(O){var K;var z=O.get("fieldType");var B=O.get("indexType");if(G){var Q=O.get("instanceId");if(!Q){Q=h();O.set("instanceId",Q)}K=R._createDynamicNode("dynamic-element",{"instance-id":Q,name:encodeURIComponent(O.get("variableName")),type:encodeURIComponent(z),"index-type":B})}else{K=R._createDynamicNode("dynamic-element",{name:encodeURIComponent(O.get("variableName")),type:encodeURIComponent(z),"index-type":B,repeatable:O.get("repeatable")})}var u=null;if(O.get("localized")){var S=O.get("localizedValue");if(S!=="false"){u={"language-id":S}}}var J=R.getNodeTypeContent();var C=R._createDynamicNode(J,u);var F=R._createDynamicNode("meta-data");var w=R._createDynamicNode("entry",{name:"instructions"});var A=R._createDynamicNode("entry",{name:"required"});var H=R._createDynamicNode("entry",{name:"displayAsTooltip"});var D=R._createDynamicNode("entry",{name:"label"});var x=R._createDynamicNode("entry",{name:"predefinedValue"});M.push(K.openTag);if(!G){R._appendStructureFieldOptionsBuffer(I,M)}R._appendStructureChildren(I,M,G);if(!G){M.push(F.openTag);var E=R.normalizeValue(O.get("displayAsTooltip"));M.push(H.openTag,"<![CDATA["+E+"]]>",H.closeTag);var y=R.normalizeValue(O.get("required"));M.push(A.openTag,"<![CDATA["+y+"]]>",A.closeTag);var t=R.normalizeValue(O.get("instructions"));M.push(w.openTag,"<![CDATA["+t+"]]>",w.closeTag);var N=R.normalizeValue(O.get("fieldLabel"));M.push(D.openTag,"<![CDATA["+N+"]]>",D.closeTag);var v=R.normalizeValue(O.get("predefinedValue"));M.push(x.openTag,"<![CDATA["+v+"]]>",x.closeTag,F.closeTag)}else{if(G){M.push(C.openTag);var P=(z=="list")||(z=="multi-list");if(P){R._appendStructureFieldOptionsBuffer(I,M,G)}else{var L=O.getContent(I)||"";M.push("<![CDATA["+L+"]]>")}M.push(C.closeTag)}}M.push(K.closeTag)}},_appendStructureFieldOptionsBuffer:function(y,v,u){var t=this;var w=t.getFieldInstance(y);var x=w.get("fieldType");var z=y.all("> .folder > .field-container > .journal-article-component-container > .journal-list-subfield option");if(z){m.each(z,function(E,C,F){var A=E.text();var H=E.val();if(!u){var G=t._createDynamicNode("dynamic-element",{name:encodeURIComponent(A),type:encodeURIComponent(H),repeatable:w.get("repeatable")});v.push(G.openTag+G.closeTag)}else{if(E.get("selected")){var B=(x=="multi-list");var D=t._createDynamicNode("option");if(B){v.push(D.openTag)}v.push("<![CDATA["+Liferay.Util.escapeCDATA(H)+"]]>");if(B){v.push(D.closeTag)}}}})}},_attachDelegatedEvents:function(){var A=this;var t=A.getById("journalArticleContainer");var y=function(C){var G=C.currentTarget;var F=G.get("parentNode");var H=F.get("parentNode").one("select");var D=F.one("input.journal-list-key");var J=D.val();var K=F.one("input.journal-list-value");var I=K.val();if(J&&I){var L=H.all("option");L.each(function(P,O,Q){var M=g.trim(J);var N=g.trim(P.text());if(N.toLowerCase()==M.toLowerCase()){P.remove()}});var E=m.Node.create(n).val(I).text(J);H.append(E);E.attr("selected","selected");D.val("").focus();K.val("value")}else{D.focus()}};var x=function(D){var C=D.currentTarget.get("parentNode").one("span.journal-add-field");if(D.isKey("ENTER")){D.currentTarget=C;y.apply(D.currentTarget,arguments)}};var v=function(F){var E=F.currentTarget;var C=E.get("parentNode").one("select").focus();var D=C.all("option");D.each(function(H,G,I){if(H.attr("selected")){H.remove()}})};t.delegate("mouseenter",function(C){var D=A.getSourceByNode(C.currentTarget);D.addClass("repeatable-border")},".repeatable-field-image");t.delegate("click",function(C){var D=A.getSourceByNode(C.currentTarget);A.closeField(D)},".repeatable-field-delete, span.journal-article-close");t.delegate("mouseleave",function(C){var D=A.getSourceByNode(C.currentTarget);D.removeClass("repeatable-border")},".repeatable-field-image");t.delegate("click",function(C){var E=C.currentTarget;var D=A.getSourceByNode(E);A.editContainerContextPanel.set("trigger",E);A.editContainerContextPanel.show()},A._getNamespacedId("#structureTree")+" div.journal-article-buttons .edit-button .aui-button-input");t.delegate("click",function(C){var D=A.getSourceByNode(C.currentTarget);A.repeatField(D)},".repeatable-field-add, .journal-article-buttons .repeatable-button .aui-button-input");t.delegate("click",function(C){var E=C.currentTarget;var D=A.getSourceByNode(E);A._updateLocaleState(D,E)},".journal-article-localized-checkbox .aui-field-input-choice");t.delegate("keypress",x,".journal-list-key, .journal-list-value");t.delegate("click",y,".journal-add-field");t.delegate("click",v,".journal-delete-field");t.delegate("click",function(G){var E=G.currentTarget;var C=null;var D=E.ancestor(".journal-image-preview");var F=D.one(".journal-image-wrapper");var H=A.getByName(D,"journalImageDelete");if(H.val()==""){H.val("delete");F.hide();C=Liferay.Language.get("cancel")}else{H.val("");F.show();C=Liferay.Language.get("delete")}E.val(C)},"#"+A.portletNamespace+"journalImageDeleteButton");t.delegate("click",function(G){var F=G.currentTarget;var C=F.get("parentNode").get("parentNode").one(".journal-image-preview");var D=F.one(".show-label").show();var E=F.one(".hide-label").show();var H=C.hasClass("aui-helper-hidden");if(H){D.hide();E.show()}else{D.show();E.hide()}C.toggle()},".journal-image-link");t.delegate("click",function(F){var D=F.currentTarget;var C=D.ancestor(".journal-article-component-container").one(".aui-field-input");var E=D.attr("data-documentlibraryUrl");window[A.portletNamespace+"selectDocumentLibrary"]=function(G){C.val(G)};A.openPopupWindow(E,Liferay.Language.get("javax.portlet.title.20"),"selectDocumentLibrary")},".journal-documentlibrary-button .aui-button-input");t.delegate("mouseover",function(E){var G=E.currentTarget;var F=A.getSourceByNode(G);var D=A.getFieldInstance(F);if(D){var C=D.get("instructions");Liferay.Portal.ToolTip.show(this,C)}},"img.journal-article-instructions-container");var z=A.getById("journalArticleEditFieldWrapper");if(z){var w=A.editContainerSaveMode;z.delegate("click",w,"input[type=checkbox]",A);var B=A.closeEditFieldOptions;z.delegate("click",B,".cancel-button .aui-button-input",A);z.delegate("click",B,".close-button .aui-button-input",A);z.delegate("click",function(C){var D=A.getSelectedField();A.saveEditFieldOptions(D)},".save-button .aui-button-input")}var u='[name="'+A.portletNamespace+'variableName"]';t.delegate("keypress",m.bind(A._onKeypressVariableName,A),u);t.delegate("keyup",m.bind(A._onKeyupVariableName,A),u);A._attachDelegatedEvents=g.emptyFn},_attachEditContainerEvents:function(x){var t=this;var u=t.getById("journalArticleEditFieldWrapper");if(u){var w=u.all("input[type=checkbox]");var z=u.all("input[type=text],select");var A=u.all("textarea");z.detach("change");z.detach("keypress");A.detach("change");A.detach("keypress");var y=t.editContainerSaveMode;var v=["change","keypress"];z.on(v,y,t);A.on(v,y,t)}},_attachEditStructureEvents:function(){var E=this;var w=E._getNamespacedId("#journalComponentList");var v=E._getNamespacedId("#structureTree");var D=E.getById("journalArticleEditFieldWrapper");var t=E.getById("fieldLabel");var B=m.one(v);var C=m.Node.create(s);var x=m.all(w+" .component-group .journal-component");var z=m.all(v+" li.structure-field");E.nestedListOptions={dd:{handles:[".journal-article-move-handler"]},dropCondition:function(G){var F=G.drop.get("node");return E.canDrop(F)},dropOn:"span.folder > ul.folder-droppable",helper:E._helper,placeholder:C,sortCondition:function(G){var F=G.drop.get("node");return F.ancestor(v)},sortOn:v};E.nestedListEvents={"drag:start":function(G){var F=E._helper;F.setStyle("height","100px");F.setStyle("width","450px");E.updateTextAreaVisibility("hidden")},"drag:end":function(F){E._dropField();E.updateTextAreaVisibility("visible")},"drag:out":function(F){if(!E.acceptChildren){E.helperIntersecting();E.acceptChildren=true}},"drag:over":function(G){var F=G.drop.get("node");E.acceptChildren=E.canDrop(F);if(E.acceptChildren){E.helperIntersecting()}else{E.helperNotIntersecting()}}};E.createNestedList(z.filter(":not(.repeated-field)").filter(":not(.parent-structure-field)"),E.nestedListOptions,E.nestedListEvents);E.componentFieldsOptions={dropCondition:function(G){var F=G.drop.get("node");return E.canDrop(F)},dropOn:"span.folder > ul.folder-droppable",helper:E._helper,placeholder:C,sortCondition:function(G){var F=G.drop.get("node");return F.ancestor(v)}};E.componentFieldsEvents={"drag:start":function(G){var J=G.target;var L=J.get("dragNode");var F=J.get("node");var N=F.text();var I=E.getComponentType(F);var K="journal-component-"+E._stripComponentType(I);var H=E._helper;var M=E._helper.all("div.journal-component");H.setStyle("height","25px");H.setStyle("width","200px");if(M){M.addClass(K).html(N)}L.addClass("component-dragging");E.updateTextAreaVisibility("hidden");E.clonedSource=F.clone();F.placeBefore(E.clonedSource);E.clonedSource.attr("id","");E.clonedSource.guid();E.clonedSource.show().setStyle("visibility","visible");E.clonedSource.removeClass("aui-helper-hidden");E.clonedSource.addClass("dragging");E.createNestedList(E.clonedSource,E.componentFieldsOptions,E.componentFieldsEvents,true)},"drag:end":function(G){var M=G.target;var F=M.get("node");var O=M.get("dragNode");var J=E.getComponentType(F);var N="journal-component-"+E._stripComponentType(J);var Q=E._helper.all("div.journal-component");O.removeClass("component-dragging");if(Q){Q.removeClass(N).empty()}var L=B.one("div.journal-component");if(L){L.hide();var U=E._fieldInstanceFactory(J);if(U.get("fieldType")=="text_area"){E.buildHTMLEditor(U)}var R=E._createFieldHTMLTemplate(U);var P=m.Node.create(R);L.placeBefore(P);L.remove();var S=P.attr("dataName");var I=P.attr("dataInstanceId");U.set("source",P);U.set("variableName",S);U.set("instanceId",I);E.createNestedList(P,E.nestedListOptions,E.nestedListEvents);var H=P.get("id");k.add(H,U);E.repositionEditFieldOptions();var K=E.getById(I+"variableName");if(K){Liferay.Util.focusFormField(K);K.select()}}else{F.remove()}E.updateTextAreaVisibility("visible");if(E.clonedSource){var T=E.getById("#journalComponentList");E.clonedSource.removeClass("dragging");if(T.contains(F[0])&&T.contains(E.clonedSource[0])){F.remove()}}},"drag:out":E.nestedListEvents["drag:out"],"drag:over":E.nestedListEvents["drag:over"]};E.createNestedList(x,E.componentFieldsOptions,E.componentFieldsEvents,true);if(D){D.show()}E.editContainerContextPanel=new m.OverlayContextPanel({after:{hide:m.bind(E.unselectFields,E),show:function(){m.later(0,E,function(){Liferay.Util.focusFormField(t)})}},align:{points:["lc","rc"]},bodyContent:D,trigger:new m.NodeList()}).render();E.editContainerContextPanel.addTarget(E);E.on("overlaycontextpanel:visibleChange",function(G){if(G.newVal==true){var F=G.target.get("trigger");F.each(function(I,H,K){var J=E.getSourceByNode(I);E.renderEditFieldOptions(J)})}});m.OverlayContextManager.remove(E.editContainerContextPanel);E._attachEditStructureEvents=g.emptyFn;var u=E.getById("articleHeaderEdit");var A=E.getById("editStructureButton");var y=E.getById("saveStructureButton");if(u){u.delegate("click",function(F){Liferay.reset("controlPanelSidebarHidden");E.disableEditMode()},E._getNamespacedId("editStructureButton"));u.delegate("click",E.openSaveStructureDialog,E._getNamespacedId("saveStructureButton"),E);u.delegate("click",function(F){F.preventDefault();E.openSaveStructureDialog()},".journal-save-structure-trigger",E)}},_attachEvents:function(){var B=this;var t=B.getById("changeStructureButton");var x=B.getById("downloadArticleContentButton");var v=B.getById("editStructureLink");var z=B.getById("loadDefaultStructure");var y=B.getById("previewArticleButton");var w=B.getById("publishButton");var u=B.getById("saveButton");var A=B.getById("translateButton");if(t){t.detach("click");t.on("click",function(D){D.preventDefault();var C=D.currentTarget.attr("href");B.openPopupWindow(C,"ChangeStructure","changeStruture")})}if(x){x.detach("click");x.on("click",function(){B.downloadArticleContent()})}if(v){v.detach("click");v.on("click",function(C){Liferay.set("controlPanelSidebarHidden",true);B._attachEditContainerEvents();B.enableEditMode()})}if(z){z.detach("click");z.on("click",function(){B.loadDefaultStructure()})}if(y){y.detach("click");y.on("click",function(){B.previewArticle()})}},_createDynamicNode:function(y,u){var t=this;var v=[];var x=[];if(!y){y="dynamic-element"}var w=["<",y,(u?" ":""),,">",,"</",y,">"];m.each(u||{},function(A,z,B){if(A!==undefined){v.push([z,'="',A,'" '].join(""))}});w[3]=v.join("").replace(/[\s]+$/g,"");x=w.join("").replace(/></,">><<").replace(/ +>/,">").split(/></);return{closeTag:x[1],openTag:x[0]}},_createFieldHTMLTemplate:function(w){var t=this;var x=w.getFieldContainer();var u=w.getFieldElementContainer();var y=w.get("innerHTML");var v=w.get("fieldType");u.html(y);return x.html()},_dropField:function(){var t=this;t.repositionEditFieldOptions()},_fieldInstanceFactory:function(w){var t=this;var x;if(g.isString(w)){x=w;w=null}else{x=w.fieldType}w=w||{};var v={"boolean":a.FieldModel.Boolean,document_library:a.FieldModel.DocumentLibrary,image:a.FieldModel.Image,link_to_layout:a.FieldModel.LinkToPage,list:a.FieldModel.List,"multi-list":a.FieldModel.MultiList,selection_break:a.FieldModel.SelectionBreak,text:a.FieldModel.Text,text_area:a.FieldModel.TextArea,text_box:a.FieldModel.TextBox};w=m.merge(v[x],w);var u=new a.StructureField(w,t.portletNamespace).render();u.get("fieldLabel");return u},_getNamespacedId:function(w,u,v){var t=this;if(!g.isString(u)){u=t.portletNamespace}if(!g.isString(v)){v="#"}w=w.replace(/^#/,"");return v+u+w},_hasFirstLevelFields:function(){var t=this;var u=m.all(t._getNamespacedId("#structureTree")+"> li");return(u&&u.size()>1)},_hasParentField:function(w){var t=this;var u=t.getFieldInstance(w);var x=w.get("id");var v=m.one("#"+x);return v&&v.ancestor().hasClass("folder-droppable")},_initializePageLoadFieldInstances:function(){var u=this;var t=u.getFields();t.each(function(M,A,G){var K=u.getFieldInstance(M);if(!K){var D=M.attr("dataName");var I=M.attr("dataType");var F=M.attr("dataDisplayAsTooltip");var v=M.attr("dataLabel");var y=M.attr("dataIndexType");var L=M.attr("dataInstanceId");var w=M.attr("dataInstructions");var B=M.one(".journal-article-localized");var E=M.attr("dataParentStructureId");var x=M.attr("dataPredefinedValue");var z=M.attr("dataRepeatable");var C=M.attr("dataRequired");var N;if(B){N=B.val()}var J=(String(N)!="false");K=u._fieldInstanceFactory({displayAsTooltip:F,fieldLabel:v,instanceId:L,instructions:w,localized:J,localizedValue:N,parentStructureId:E,predefinedValue:x,repeatable:z,required:C,source:M,fieldType:I,indexType:y,variableName:D})}var H=M.get("id");k.add(H,K)})},_initializeTagsSuggestionContent:function(){var t=this;window[t.portletNamespace+"getSuggestionsContent"]=function(){var u=[];t.getFields().each(function(x,w,z){var v=t.getFieldInstance(x);var y=v.getContent(x);u.push(y)});return u.join(" ")}},_loadEditor:function(u,w){var t=this;var v=t.buildHTMLEditorURL(u);m.io.request(v,{method:"GET",on:{success:function(z,B,A){var y=this.get("responseData");var x=m.one("#"+w);x.plug(m.Plugin.ParseContent);x.setContent(y)}}})},_onKeyupVariableName:function(w){var t=this;var v=w.currentTarget;var x=t.getSourceByNode(v);var u=t.getFieldInstance(x);if(u){var y=v.val();t.updateFieldVariableName(u,y)}},_onKeypressVariableName:function(v){var t=this;if(!v.isKeyInSet("BACKSPACE","DELETE","LEFT","RIGHT")){var u=/^[\w_-]$/;var w=String.fromCharCode(v.keyCode);if(!u.test(w)){v.halt()}}},_stripComponentType:function(t){return t.toLowerCase().replace(/[^a-z]+/g,"")},_translateErrorMessage:function(u){var t="";if(u.indexOf("StructureXsdException")>-1){t=Liferay.Language.get("please-enter-a-valid-xsd")}else{if(u.indexOf("DuplicateStructureElementException")>-1){t=Liferay.Language.get("please-enter-unique-structure-field-names-(including-field-names-inherited-from-the-parent-structure)")}else{if(u.indexOf("DuplicateStructureIdException")>-1){t=Liferay.Language.get("please-enter-a-unique-id")}else{if(u.indexOf("StructureDescriptionException")>-1){t=Liferay.Language.get("please-enter-a-valid-description")}else{if(u.indexOf("StructureIdException")>-1){t=Liferay.Language.get("please-enter-a-valid-id")}else{if(u.indexOf("StructureInheritanceException")>-1){t=Liferay.Language.get("this-structure-is-already-within-the-inheritance-path-of-the-selected-parent-please-select-another-parent-structure")}else{if(u.indexOf("StructureNameException")>-1){t=Liferay.Language.get("please-enter-a-valid-name")}else{if(u.indexOf("NoSuchStructureException")>-1){t=Liferay.Language.get("please-enter-a-valid-id")}else{if(u.indexOf("ArticleContentException")>-1){t=Liferay.Language.get("please-enter-valid-content")}else{if(u.indexOf("ArticleIdException")>-1){t=Liferay.Language.get("please-enter-a-valid-id")}else{if(u.indexOf("ArticleTitleException")>-1){t=Liferay.Language.get("please-enter-a-valid-name")}else{if(u.indexOf("DuplicateArticleIdException")>-1){t=Liferay.Language.get("please-enter-a-unique-id")}}}}}}}}}}}}return t},_updateLocaleState:function(t,x){var z=this;var u=x.get("checked");var B=z.getDefaultLocale();var v=t.one(".journal-article-localized");var y=B;var w=function(C){if(v){v.val(C)}};if(u){w(y)}else{if(!confirm(Liferay.Language.get("unchecking-this-field-will-remove-localized-data-for-languages-not-shown-in-this-view"))){x.attr("checked",true);w(y)}else{w(false)}}var A=z.getFieldInstance(t);A.set("localized",x.get("checked"));A.setInstanceId(A.get("instanceId"))},_updateOriginalStructureXSD:function(){var t=this;var v=t.getPrincipalForm();var w=encodeURIComponent(t.getStructureXSD());var u=t.getByName(v,"structureXSD");if(u){u.val(w)}}};m.augment(a,m.EventTarget);var f=m.Component.create({ATTRS:{content:{validator:g.isString,value:""},displayAsTooltip:{setter:function(u){var t=this;return t.setAttribute("displayAsTooltip",i.Boolean.parse(u))},valueFn:function(){var t=this;return t.getAttribute("displayAsTooltip",true)}},fieldLabel:{setter:function(u){var t=this;return t.setFieldLabel(u)},valueFn:function(){var t=this;return t.getAttribute("fieldLabel","")}},fieldType:{setter:function(u){var t=this;return t.setAttribute("fieldType",u)},validator:g.isString,value:""},localized:{valueFn:function(){var t=this;var u=t.getLocalizedValue();return(String(u)=="true")}},localizedValue:{getter:function(){var t=this;return t.getLocalizedValue()}},indexType:{setter:function(u){var t=this;return t.setAttribute("IndexType",u)},valueFn:function(){var t=this;return t.getAttribute("IndexType","")}},innerHTML:{validator:g.isString,value:q},instructions:{setter:function(u){var t=this;return t.setInstructions(u)},valueFn:function(){var t=this;return t.getAttribute("instructions","")}},instanceId:{setter:function(u){var t=this;return t.setInstanceId(u)},valueFn:function(){var t=this;var u=h();return t.getAttribute("instanceId",u)}},optionsEditable:{validator:g.isBoolean,value:true},parentStructureId:{setter:function(u){var t=this;return t.setAttribute("parentStructureId",u)},valueFn:function(){var t=this;return t.getAttribute("parentStructureId","")}},predefinedValue:{setter:function(u){var t=this;return t.setAttribute("predefinedValue",u)},valueFn:function(){var t=this;return t.getAttribute("predefinedValue","")}},repeatable:{setter:function(u){var t=this;return t.setRepeatable(i.Boolean.parse(u))},valueFn:function(){var t=this;return t.getAttribute("repeatable",false)}},repeated:{getter:function(){var t=this;return t.get("source").hasClass("repeated-field")}},required:{setter:function(u){var t=this;return t.setAttribute("required",i.Boolean.parse(u))},valueFn:function(){var t=this;return t.getAttribute("required",false)}},source:{value:null},variableName:{setter:function(u){var t=this;return t.setVariableName(u)},validator:g.isString,valueFn:function(){var t=this;return t.getAttribute("name")}}},EXTENDS:m.Widget,NAME:"structurefield",constructor:function(u,v){var t=this;t._lazyAddAttrs=false;t.portletNamespace=v;f.superclass.constructor.apply(this,arguments)},UI_ATTRS:["optionsEditable"],prototype:{cloneableAttrs:["displayAsTooltip","fieldLabel","fieldType","indexType","innerHTML","instructions","localized","localizedValue","predefinedValue","repeatable","required","variableName"],initializer:function(){var u=this;var t=u.propagateAttr;m.each(u.cloneableAttrs,function(w,v,x){if(w!="localized"){u.after(w+"Change",t)}})},destructor:function(){var t=this;var y=t.get("source");var w=y.all(".structure-field");w.each(function(C,B,D){var A=t.getFieldInstance(C);if(A){A.destroy()}});var v=t.get("fieldType");if(v=="text_area"){var u=y.one("textarea");if(u){var z=u.attr("name");var x=window[z];if(x&&g.isFunction(x.destroy)){x.destroy()}}}},canDrop:function(){var t=this;return a.prototype.canDrop.apply(t,arguments)},clone:function(){var t=this;var u={};var v=t.portletNamespace;m.each(t.cloneableAttrs,function(x,w,y){u[x]=t.get(x)});u.source=null;return new f(u,v)},createInstructionsContainer:function(t){return m.Node.create(e).html(t)},createTooltipImage:function(){return m.Node.create(b)},getAttribute:function(v,u){var t=this;var x;var w=t.get("source");if(w){x=w.attr("data"+v)}if(g.isUndefined(x)&&!g.isUndefined(u)){x=u}return x},getByName:function(){var t=this;return a.prototype.getByName.apply(t,arguments)},getComponentType:function(){var t=this;return a.prototype.getComponentType.apply(t,arguments)},getContent:function(u){var F=this;var B;var C=F.get("fieldType");var w=u.one("div.journal-article-component-container");var z=w.one(".aui-field-input");if(C=="boolean"){B=z.attr("checked")}else{if(C=="text_area"){var y=u.one("textarea").attr("name");var D=window[y];if(D&&g.isFunction(D.getHTML)){B=D.getHTML()}}else{if(C=="multi-list"){var v=[];var G=z.all("option");G.each(function(I,H,K){if(I.get("selected")){var J=I.val();v.push(J)}});B=v.join(",")}else{if(C=="image"){var A=F.getByName(w,"journalImageDelete");if(A&&(A.val()=="delete")){B="delete"}else{var x=w.one(".journal-image-field input");var t=x.val()||false;if(t){B=t}else{var E=w.one(".journal-image-preview input.journal-image-preview-content");if(E){B=E.val()}}}}else{if(z){B=z.val()}}}}}if((C=="list")||(C=="multi-list")||(C=="text")||(C=="text_box")){B=Liferay.Util.escapeCDATA(B)}F.set("content",B);return B},getFieldContainer:function(){var H=this;if(!H.fieldContainer){var B=[];var u=Liferay.Language.get("field");var A=Liferay.Language.get("localizable");var v=Liferay.Language.get("this-field-is-required");var J=Liferay.Language.get("variable-name");var C=H.get("optionsEditable");var D=H.getById("editButtonTemplate");var F="";if(D){F=D.html()}var G="";if(!C){G="aui-helper-hidden"}var I=H.getById("repeatableButtonTemplate");var z="";if(I){z=I.html()}var x=H.get("fieldType");var y=H.get("required");var E=H.get("variableName")+l();var w=h();B=g.sub(r,{articleButtonsRowCSSClass:G,cssClass:"journal-structure-"+x.replace(/_/g,"-"),editButtonTemplateHTML:F,fieldLabel:u,localizedLabelLanguage:A,instanceId:w,portletNamespace:H.portletNamespace,repeatableButtonTemplateHTML:z,requiredFieldLanguage:v,variableName:E,variableNameLanguage:J});H.fieldContainer=m.Node.create(B);var t=H.fieldContainer.one("li");t.setAttribute("dataName",E);t.setAttribute("dataRequired",y);t.setAttribute("dataType",x);t.setAttribute("dataInstanceId",w);if(!H.canDrop(t)){H.fieldContainer.one(".folder-droppable").remove()}}return H.fieldContainer},getFieldElementContainer:function(){var t=this;if(!t.fieldElementContainer){t.fieldElementContainer=t.getFieldContainer().one("div.journal-article-component-container")}return t.fieldElementContainer},getFieldInstance:function(){var t=this;return a.prototype.getFieldInstance.apply(t,arguments)},getFieldLabelElement:function(){var t=this;var u=t.get("source");if(!u){u=t.getFieldContainer().one("li")}return u.one("> .folder > .field-container .journal-article-field-label")},getLocalizedValue:function(){var t=this;var v=t.get("source");var u;if(v){u=v.one(".journal-article-localized")}return u?u.val():"false"},getRepeatedSiblings:function(){var t=this;return a.prototype.getRepeatedSiblings.apply(t,[t])},propagateAttr:function(u){var t=this;var v=t.getRepeatedSiblings();if(v){v.each(function(y,x,z){var w=t.getFieldInstance(y);if(w){w.set(u.attrName,u.newVal)}})}},setFieldLabel:function(v){var t=this;var u=t.getFieldLabelElement();if(!v){v=t.get("variableName")}if(u){u.one("span").html(v);t.setAttribute("fieldLabel",v)}return v},setInstanceId:function(y){var t=this;t.setAttribute("instanceId",y);var v=t.get("fieldType");var x=t.get("source");if((v=="image")&&x){var w=t.get("localized");var z=t.portletNamespace+"structure_image_"+y+"_"+t.get("variableName");var u=x.one(".journal-article-component-container [type=file]");if(w){z+="_"+t.get("localizedValue")}u.attr("name",z)}return y},setInstructions:function(B){var C=this;var t=C.get("source");if(t){var D=C.getFieldInstance(t);C.setAttribute("instructions",B);if(D){var v=t.one("> .folder > .field-container");var z=D.getFieldLabelElement();var u=z.one(".journal-article-instructions-container");var w=v.one(".journal-article-instructions-message");var A=D.get("displayAsTooltip");if(u){u.remove()}if(w){w.remove()}if(B){if(!A){var x=D.createInstructionsContainer(B);var y=v.one(".journal-article-required-message");y.placeAfter(x)}else{if(z){z.append(D.createTooltipImage())}}}}}return B},setRepeatable:function(y){var t=this;var x=t.get("source");t.setAttribute("repeatable",y);if(x){var v=t.getFieldInstance(x);var A=x.one("> .folder > .field-container");var w=A.one(".repeatable-field-image");var u=x.one(".journal-article-buttons .repeatable-button");if(w){w.remove()}if(y){var z=m.Node.create(m.one("#repeatable-field-image-model").html());A.append(z);if(u){u.show()}}else{if(u){u.hide()}}}return y},setVariableName:function(w){var t=this;var v=t.getFieldLabelElement();if(v){var u=v.get("parentNode").one(".journal-article-component-container .aui-field-input");if(u){u.attr("id",w);v.setAttribute("for",w)}t.setAttribute("name",w)}return w},setAttribute:function(u,w){var t=this;var v=t.get("source");if(g.isArray(w)){w=w[0]}if(v){v.setAttribute("data"+u,w)}return w},_uiSetOptionsEditable:function(w){var t=this;var v=t.get("source");if(v){var u=v.one(".journal-article-buttons");if(u){if(w){u.show()}else{u.hide()}}}},_getNamespacedId:a.prototype._getNamespacedId,getById:a.prototype.getById}});a.StructureField=f;a.FieldModel={};var p=a.FieldModel;var c=function(x,w,y,v){var u=this;var t=m.one('#journalFieldModelContainer div[dataType="'+w+'"]');var z;if(t){z=t.html()}p[x]={fieldLabel:y,fieldType:w,innerHTML:z,optionsEditable:v,variableName:y}};c("Text","text","TextField",true);c("TextArea","text_area","TextAreaField",true);c("TextBox","text_box","TextBoxField",true);c("Image","image","ImageField",true);c("DocumentLibrary","document_library","DocumentLibraryField",true);c("Boolean","boolean","BooleanField",true);c("List","list","ListField",true);c("MultiList","multi-list","MultiListField",true);c("LinkToPage","link_to_layout","LinkToPageField",true);c("SelectionBreak","selection_break","SelectionBreakField",false);Liferay.Portlet.Journal=a},"",{requires:["aui-base","aui-data-set","aui-datatype","aui-dialog","aui-dialog-iframe","aui-io-request","aui-nested-list","aui-overlay-context-panel","json"]});