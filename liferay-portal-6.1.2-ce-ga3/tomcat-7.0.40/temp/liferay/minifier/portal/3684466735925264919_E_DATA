AUI.add("liferay-portlet-dynamic-data-lists",function(f){var e=f.Array;var g=f.DataType.DateMath;var h=f.Lang;var m=Liferay.Service.DDL;var a=m.DDLRecord;var j=m.DDLRecordSet;var i=Liferay.Service.DL.DLApp;var o=f.Object.keys;var n=f.JSON;var d=f.Lang.emptyFn;var c=",";var l="";var k=f.Component.create({NAME:"document-library-file-entry-cell-editor",EXTENDS:f.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input type="hidden" />',initializer:function(){var p=this;window[Liferay.Util.getPortletNamespace("15")+"selectDocumentLibrary"]=f.bind(p._selectFileEntry,p)},getElementsValue:function(){var p=this;return p.get("value")},_defInitToolbarFn:function(){var p=this;k.superclass._defInitToolbarFn.apply(p,arguments);p.toolbar.add({handler:f.bind(p._handleChooseEvent,p),label:Liferay.Language.get("choose")},1)},_handleChooseEvent:function(){var p=this;var q=Liferay.Util.addParams({groupId:themeDisplay.getScopeGroupId(),p_p_id:"15",p_p_state:"pop_up",struts_action:"/journal/select_document_library"},themeDisplay.getURLControlPanel());Liferay.Util.openWindow({id:"selectDocumentLibrary",title:Liferay.Language.get("javax.portlet.title.20"),uri:q})},_selectFileEntry:function(r,t,s,u,q){var p=this;p.selectedTitle=u;p.selectedURL=r;p.set("value",n.stringify({groupId:s,title:u,uuid:t,version:q}))},_syncFileLabel:function(t,s){var p=this;var r=p.get("contentBox");var q=r.one("a");if(!q){q=f.Node.create("<a></a>");r.prepend(q)}q.setAttribute("href",s);q.setContent(t)},_uiSetValue:function(s){var p=this;if(s){var r=p.selectedTitle;var q=p.selectedURL;if(r&&q){p._syncFileLabel(r,q)}else{b.Util.getFileEntry(s,function(u){var t=b.Util.getFileEntryURL(u);p._syncFileLabel(u.title,t)})}}else{p._syncFileLabel(l,l);s=l}p.elements.val(s)}}});var b=f.Component.create({ATTRS:{portletNamespace:{validator:h.isString,value:l},recordsetId:{validator:h.isNumber,value:0},structure:{validator:h.isArray,value:[]}},CSS_PREFIX:"",DATATYPE_VALIDATOR:{date:"date","double":"number",integer:"digits","long":"digits"},EXTENDS:f.DataTable.Base,NAME:f.DataTable.Base.NAME,TYPE_EDITOR:{checkbox:f.CheckboxCellEditor,"ddm-date":f.DateCellEditor,"ddm-decimal":f.TextCellEditor,"ddm-integer":f.TextCellEditor,"ddm-number":f.TextCellEditor,radio:f.RadioCellEditor,select:f.DropDownCellEditor,text:f.TextCellEditor,textarea:f.TextAreaCellEditor},prototype:{initializer:function(){var p=this;var q=p.get("recordset");q.on("update",p._onRecordUpdate,p)},addEmptyRows:function(q){var p=this;var t=p.get("columnset");var s=p.get("recordset");var r=b.buildEmptyRecords(q,o(t.keyHash));s.add(r);p._uiSetRecordset(s);p._fixPluginsUI()},updateMinDisplayRows:function(r,s){var p=this;s=(s&&f.bind(s,p))||d;var q=p.get("recordsetId");j.updateMinDisplayRows({recordsetId:q,minDisplayRows:r,serviceContext:n.stringify({scopeGroupId:themeDisplay.getScopeGroupId(),userId:themeDisplay.getUserId()})},s)},_editCell:function(v){var p=this;b.superclass._editCell.apply(p,arguments);var u=v.column;var r=v.record;var w=p.get("recordset");var t=p.get("recordsetId");var q=p.get("structure");var s=p.getCellEditor(r,u);if(s){s.set("record",r);s.set("recordset",w);s.set("recordsetId",t);s.set("structure",q)}},_normalizeRecordData:function(r){var p=this;var t=p.get("recordset");var q=p.get("structure");var s={};f.each(r,function(w,u,y){var x=b.findStructureFieldByAttribute(q,"name",u);if(x!==null){var v=x.type;if((v==="radio")||(v==="select")){if(!h.isArray(w)){w=e(w)}w=n.stringify(w)}}s[u]=p._normalizeValue(w)});delete s.displayIndex;delete s.recordId;return s},_normalizeValue:function(q){var p=this;return String(q)},_onRecordUpdate:function(s){var p=this;var r=p.get("recordsetId");var q=s.index;e.each(s.updated,function(u,t,w){var v=u.get("data");var x=p._normalizeRecordData(v);if(v.recordId>0){b.updateRecord(v.recordId,q,x,true)}else{b.addRecord(r,q,x,function(y){if(y.recordId>0){v.recordId=y.recordId}})}})}},addRecord:function(s,q,u,t){var p=this;t=(t&&f.bind(t,p))||d;var r=["long","long","int","java.util.Map<java.lang.String, java.io.Serializable>","com.liferay.portal.service.ServiceContext"];a.addRecord({groupId:themeDisplay.getScopeGroupId(),recordsetId:s,displayIndex:q,fieldsMap:n.stringify(u),serviceContext:n.stringify({scopeGroupId:themeDisplay.getScopeGroupId(),userId:themeDisplay.getUserId(),workflowAction:Liferay.Workflow.ACTION_PUBLISH}),serviceParameterTypes:n.stringify(r)},t)},buildDataTableColumnset:function(s,q,r){var p=this;e.each(s,function(E,y,x){var D=E.dataType;var C=E.label;var t=E.name;var A=E.type;E.key=t;var F=p.TYPE_EDITOR[A]||f.TextCellEditor;var u={elementName:t,validator:{rules:{}}};var z=E.required;var B;if(z){E.label+=" ("+Liferay.Language.get("required")+")"}if(A==="checkbox"){u.options={"true":Liferay.Language.get("true")};u.inputFormatter=function(I){return String(I.length>0)};E.formatter=function(K){var J=K.record.get("data");var I=J[t];if(I==="true"){I=Liferay.Language.get("true")}else{if(I==="false"){I=Liferay.Language.get("false")}}return I}}else{if(A==="ddm-date"){u.inputFormatter=function(K){var I=f.DataType.Date.parse(K);var J=l;if(I){J=I.getTime()}return J};E.formatter=function(L){var K=L.record.get("data");var J=K[t];if(J!==l){var I=new Date(h.toInt(J));I=g.add(J,g.MINUTES,J.getTimezoneOffset());J=f.DataType.Date.format(I)}return J}}else{if(A==="ddm-documentlibrary"){E.formatter=function(M){var L=M.record.get("data");var J=l;var K=L[t];if(K!==l){var I=b.Util.parseJSON(K);if(I.title){J=I.title}}return J}}else{if(A==="ddm-fileupload"){E.formatter=function(M){var L=M.record.get("data");var J=l;var K=L[t];if(K!==l){var I=b.Util.parseJSON(K);if(I.classPK){J=I.name}}return J};B=p.findStructureFieldByAttribute(q,"name",t);u.validator.rules[t]={acceptFiles:B.acceptFiles,requiredFields:true}}else{if((A==="radio")||(A==="select")){B=p.findStructureFieldByAttribute(q,"name",t);var H=f.DataType.Boolean.parse(B.multiple);var G=p.getCellEditorOptions(B.options);E.formatter=function(L){var K=L.record.get("data");var I=[];var J=K[t];e.each(J,function(M,O,N){I.push(G[M])});return I.join(", ")};u.inputFormatter=e;u.multiple=H;u.options=G}}}}}var w=p.DATATYPE_VALIDATOR[D];var v=u.validator.rules;v[t]=f.mix({required:z},v[t]);if(w){v[t][w]=true}if(r&&E.editable){E.editor=new F(u)}});return s},buildEmptyRecords:function(q,s){var p=this;var t=[];for(var r=0;r<q;r++){t.push(p.getRecordModel(s))}return t},findStructureFieldByAttribute:function(p,q,r){var s=null;e.some(p,function(u,t,v){s=u;return(s[q]===r)});return s},getCellEditorOptions:function(p){var q={};e.each(p,function(s,r,t){q[s.value]=s.label});return q},getRecordModel:function(r){var p=this;var q={};e.each(r,function(t,s,u){q[t]=l});return q},updateRecord:function(s,q,v,u,t){var p=this;t=(t&&f.bind(t,p))||d;var r=["long","int","java.util.Map<java.lang.String, java.io.Serializable>","boolean","com.liferay.portal.service.ServiceContext"];a.updateRecord({recordId:s,displayIndex:q,fieldsMap:n.stringify(v),merge:u,serviceContext:n.stringify({scopeGroupId:themeDisplay.getScopeGroupId(),userId:themeDisplay.getUserId(),workflowAction:Liferay.Workflow.ACTION_PUBLISH}),serviceParameterTypes:n.stringify(r)},t)}});b.Util={getFileEntry:function(q,r){var p=this;q=p.parseJSON(q);i.getFileEntryByUuidAndGroupId({uuid:q.uuid,groupId:q.groupId},r)},getFileEntryURL:function(r){var p=this;var q=[themeDisplay.getPathContext(),"documents",r.groupId,r.folderId,encodeURIComponent(r.title)];return q.join("/")},parseJSON:function(r){var p=this;var q={};try{q=n.parse(r)}catch(s){}return q}};b.TYPE_EDITOR["ddm-documentlibrary"]=k;Liferay.SpreadSheet=b},"",{requires:["aui-arraysort","aui-datatable","json","liferay-portlet-url"]});